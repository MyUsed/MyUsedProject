<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap namespace="order">
	
	<insert id="insertOrderlist" parameterClass="java.util.Map">
		insert into orderlist values(orderlist_seq.NEXTVAL, 
									#buy_memnum#,
									#buy_id#,
									#buy_name#,
									#sell_pronum#,
									#sell_memnum#,
									#sell_id#,
									#sell_name#,
									#sell_categ#,
									#sell_propic#,
									#send_name#,
									#send_ph#,
									#send_adrnum#,
									#send_addr#,
									#send_addrr#,
									#buy_price#,
									default,
									sysdate
									)
	</insert>
	
	 	<!-- orderlist 전체 꺼내는 쿼리 -->
	<select id="selectOrderlist" resultClass="product.orderlistDTO">
		select * from orderlist order by seq_num desc
	</select>
		<!-- orderlist 에서 게시글번호  꺼내는 쿼리 -->
	<select id="selectProNum" resultClass="int" parameterClass="int">
		select sell_pronum from orderlist where seq_num = #seq_num#
	</select>
		<!-- orderlist 에서 판매회원번호 꺼내는 쿼리 -->
	<select id="selectMem_num" resultClass="int" parameterClass="int" >
		select sell_memnum from orderlist where sell_pronum = #seq_num#
	</select>
	
		<!-- 회원번호를 기준으로 최신 주문내역 가져오기 -->
	<select id="buyOrderlist" resultClass="product.orderlistDTO" parameterClass="int">
		select * from orderlist where buy_memnum = #mem_num# and seq_num = (select max(seq_num) from orderlist)
	</select>
		<!-- 개인의 구매내역을 가져옴  -->
	<select id="butOrderAll" resultClass="product.orderlistDTO" parameterClass="int">
		select * from orderlist where buy_memnum = #mem_num# order by seq_num desc
	</select>

		<!-- 시퀀스로 orderlist 찾아 꺼내는 쿼리  -->
	<select id="noticeOrderlist" resultClass="product.orderlistDTO" parameterClass="int">
		select * from orderlist where seq_num = #seq_num#
	</select>
	
		<!-- 입금확인을 처리하기위한 state 업데이트 -->
	<update id="updateState" parameterClass="int">
		update orderlist set state = state+1 where seq_num = #seq_num#
	</update>
	
	
		<!-- 거래중 처리하기위한 proboardlist 업데이트 -->
	<update id="updateProboardlist" parameterClass="int">
		update proboardlist set sendpay = null where num = #pro_num#
	</update>
	
		<!-- 거래중 처리를 위한 개인DB 업데이트  -->
	<update id="updateProboard" parameterClass="java.util.Map">
		update proboard_$mem_num$ set sendpay = null where num = (select num from proboard_$mem_num$ where reg = (select reg from proboardlist where num = $pro_num$))
	</update>
		
		
		<!-- notice 테이블에 값 삽입 -->
	<insert id="insertNotice" parameterClass="java.util.Map">
		insert into notice_$num$ values(notice_$num$seq.NEXTVAL,#board_num#,#pro_num#,#call_memnum#,#call_name#,#categ#,#state#,sysdate)	
	</insert>
	
	
	
</sqlMap>